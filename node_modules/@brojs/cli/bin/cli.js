#!/usr/bin/env node

import { Command } from "commander";
import chalk from 'chalk';
import startServer from '@brojs/dev-server'

import pkg  from  "../package.json" with { type: 'json' };
import { build } from '../lib/build.js'

const program = new Command();

program
  .name("brojs")
  .version(pkg.version)
  .description("CLI for work with brojs projects");

program.command('build')
.description('build project')
.option("--dev", "build in developmant mode")
.action(({ dev }) => {
  if (dev) {
    process.env.NODE_ENV = "development";
  }
  build({ prod: !dev });
});

program.command('server')
  .description(
    `start dev server`
  )
  .option('--port <number>', 'server port', '8080')
  .option('--with-open-browser', 'auto open browser on start', false)
  // .option('--no-external')
  .action(({ port, withOpenBrowser }) => {
    process.env.NODE_ENV = "development";
    startServer({ port, withOpenBrowser })
  })

program.parse();

export function cli() {
  // program.parse(process.argv);
}

import path from "node:path";
import { locatePathSync as locatePath } from "locate-path";
import fs from "node:fs";

export const getProjectConfig = async () => {
  const serverRcPath = locatePath([
    path.resolve("bro.config.js"),
    // Поддержка старых проектов на ijl.
    path.resolve("ijl.config.js"),
  ]);
  if (serverRcPath) {
    return await import(`file:\\\\${serverRcPath}`);
  }

  const configNoExt = locatePath([
    path.resolve(".broconfigrc"),
    path.resolve("bro.config.json"),

    // Поддержка старых проектов на ijl.
    path.resolve(".ijlconfigrc"),
    path.resolve("ijl.config.json"),
  ]);

  if (configNoExt) {
    return JSON.parse(fs.readFileSync(configNoExt, "utf-8"));
  }

  return {};
};
